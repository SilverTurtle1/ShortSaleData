<!DOCTYPE html>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="/static/js/treemap.js"></script>
<html lang="en">
<head>
    <meta charset="UTF-8">
<!--    <link href="/static/css/nav.css" rel="stylesheet">-->
    <link type="text/css" rel="stylesheet" href="/static/css/vanilla-datetimerange-picker.css">
    <link type="text/css" rel="stylesheet" href="/static/css/modal.css">
<!--    <link type="text/css" rel="stylesheet" href="/static/css/flowalgo.css">-->
    <!--    <link href="https://www.cssscript.com/demo/sticky.css" rel="stylesheet" type="text/css">-->
    <!--    <style>-->
    <!--            html,* { font-family: 'Inter'; box-sizing: border-box; }-->
    <!--    body { background-color: #fafafa; line-height:1.6;}-->
    <!--    .lead { font-size: 1.5rem; font-weight: 300; }-->
    <!--    .container { margin: 150px auto; max-width: 960px; }-->
    <!--    </style>-->
    <title>FINRA Short Sale Data Treemap</title>
</head>
<body>
<!--<div id="payload">-->
<!--<ons-sliding-menu main-page="page1.html" menu-page="menu.html" side="left" max-slide-distance="250px" var="menu">-->
<!--</ons-sliding-menu>-->

<!--<ons-template id="page1.html">-->
<!--  <ons-page>-->
<!--    <ons-toolbar>-->
<!--      <div class="left">-->
<!--        <ons-toolbar-button ng-click="menu.toggleMenu()">-->
<!--          <ons-icon icon="ion-navicon" style="font-size: 32px; width: 1em;"></ons-icon>-->
<!--        </ons-toolbar-button>-->
<!--      </div>-->
<!--      <div class="center">Page 1</div>-->
<!--    </ons-toolbar>-->

<!--    <p style="text-align: center; color: #999; padding-top: 100px;">Page1 Contents</p>-->
<!--  </ons-page>-->
<!--</ons-template>-->


<!--<ons-template id="page2.html">-->
<!--  <ons-page>-->
<!--    <ons-toolbar>-->
<!--      <div class="left">-->
<!--        <ons-toolbar-button onclick="menu.toggleMenu()">-->
<!--          <ons-icon icon="ion-navicon" style="font-size: 32px; width: 1em;"></ons-icon>-->
<!--        </ons-toolbar-button>-->
<!--      </div>-->
<!--      <div class="center">Page 2</div>-->
<!--    </ons-toolbar>-->

<!--    <p style="text-align: center; color: #999; padding-top: 100px;">Page2 Contents</p>-->
<!--  </ons-page>-->
<!--</ons-template>-->

<!--<ons-template id="menu.html">-->
<!--  <ons-list>-->
<!--    <ons-list-item modifier="chevron" onclick="menu.setMainPage('page1.html', {closeMenu: true})">-->
<!--      page1.html-->
<!--    </ons-list-item>-->
<!--    <ons-list-item modifier="chevron" onclick="menu.setMainPage('page2.html', {closeMenu: true})">-->
<!--      page2.html-->
<!--    </ons-list-item>-->
<!--  </ons-list>-->
<!--</ons-template>-->

<!--Navigation bar-->
<div id="nav-placeholder">

</div>
<!--<script>-->
<!--    $(function(){-->
<!--      $("#nav-placeholder").load("/templates/nav.html");-->
<!--    });-->
<!--</script>-->
<div class="container">
    <h1>FINRA Short Sale Data Treemap</h1>
    <p class="lead">Select a date range for the data</p>
    <input type="text" id="datetimerange-input1" size="40"></input>
</div>
<!--<aside class="absolute sm:relative translate-x-0 md:flex flex-shrink-0 min-h-screen pt-16 z-20 md:border-r md:border-legacy-card-hover bg-legacy-layout w-0 md:w-16">-->
<!--    <div class="flex flex-1 flex-col transition-width mx-auto">-->
<!--        <div class="flex flex-col flex-grow py-4 overflow-y-auto space-y-3">-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center" href="/"><span><svg-->
<!--                    class="fill-current h-6 w-6" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path-->
<!--                    d="M14,19H3c-0.552,0-1-0.448-1-1V2c0-0.552,0.448-1,1-1h11c0.552,0,1,0.448,1,1v16C15,18.552,14.552,19,14,19z "></path><path-->
<!--                    d="M14,31H3c-0.552,0-1-0.448-1-1v-8c0-0.552,0.448-1,1-1h11c0.552,0,1,0.448,1,1v8 C15,30.552,14.552,31,14,31z"></path><path-->
<!--                    d="M29,11H18c-0.552,0-1-0.448-1-1V2c0-0.552,0.448-1,1-1h11c0.552,0,1,0.448,1,1v8 C30,10.552,29.552,11,29,11z"></path><path-->
<!--                    d="M29,31H18c-0.552,0-1-0.448-1-1V14c0-0.552,0.448-1,1-1h11c0.552,0,1,0.448,1,1v16 C30,30.552,29.552,31,29,31z"></path></svg></span></a>-->
<!--            </div>-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center"-->
<!--                    href="/chain-oi-analysis"><span><div class="relative mb-4"><svg xmlns="http://www.w3.org/2000/svg"-->
<!--                                                                                    class="fill-current h-6 w-6"-->
<!--                                                                                    viewBox="0 0 24 24"><path-->
<!--                    d="M3 1C1.89 1 1 1.89 1 3V14C1 15.11 1.89 16 3 16H14C15.11 16 16 15.11 16 14V11H14V14H3V3H14V5H16V3C16 1.89 15.11 1 14 1M9 7C7.89 7 7 7.89 7 9V12H9V9H20V20H9V18H7V20C7 21.11 7.89 22 9 22H20C21.11 22 22 21.11 22 20V9C22 7.89 21.11 7 20 7H9"></path></svg><span-->
<!--                    class="absolute bg-quantBlue font-bold text-xs text-white px-1 rounded-sm mt-1 -ml-1">New</span></div></span></a>-->
<!--            </div>-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center" href="/statistics"><span><svg-->
<!--                    class="fill-current h-6 w-6" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path-->
<!--                    d="M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z"></path></svg></span></a></div>-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center" href="/news"><span><svg-->
<!--                    class="fill-current h-6 w-6" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path-->
<!--                    fill-rule="evenodd"-->
<!--                    d="M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 002 2H4a2 2 0 01-2-2V5zm3 1h6v4H5V6zm6 6H5v2h6v-2z"-->
<!--                    clip-rule="evenodd"></path><path-->
<!--                    d="M15 7h1a2 2 0 012 2v5.5a1.5 1.5 0 01-3 0V7z"></path></svg></span></a></div>-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center bg-white bg-opacity-5 border-r-2 border-quantBlue text-quantBlue"-->
<!--                    href="/historical"><span><svg class="fill-current h-6 w-6" viewBox="0 0 20 20"-->
<!--                                                  xmlns="http://www.w3.org/2000/svg"><path-->
<!--                    d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"></path></svg></span></a>-->
<!--            </div>-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center" href="/dark-pool"><span><svg-->
<!--                    class="fill-current h-6 w-6" focusable="false" viewBox="0 0 24 24" aria-hidden="true"-->
<!--                    data-ga-event-category="material-icons" data-ga-event-action="click"-->
<!--                    data-ga-event-label="FormatAlignLeft"><path-->
<!--                    d="M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z"></path></svg></span></a>-->
<!--            </div>-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center" href="/newsletter"><span><div-->
<!--                    class="relative mb-4"><svg class="fill-current h-6 w-6" viewBox="0 0 24 24"><path-->
<!--                    fill="currentColor"-->
<!--                    d="M20 5L20 19L4 19L4 5H20M20 3H4C2.89 3 2 3.89 2 5V19C2 20.11 2.89 21 4 21H20C21.11 21 22 20.11 22 19V5C22 3.89 21.11 3 20 3M18 15H6V17H18V15M10 7H6V13H10V7M12 9H18V7H12V9M18 11H12V13H18V11Z"></path></svg><span-->
<!--                    class="absolute bg-quantBlue font-bold text-xs text-white px-1 rounded-sm mt-1 -ml-1">New</span></div></span></a>-->
<!--            </div>-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center" href="/reports"><span><svg-->
<!--                    class="fill-current h-6 w-6" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path-->
<!--                    fill-rule="evenodd"-->
<!--                    d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm2 10a1 1 0 10-2 0v3a1 1 0 102 0v-3zm2-3a1 1 0 011 1v5a1 1 0 11-2 0v-5a1 1 0 011-1zm4-1a1 1 0 10-2 0v7a1 1 0 102 0V8z"-->
<!--                    clip-rule="evenodd"></path></svg></span></a></div>-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center" href="/charting"><span><svg-->
<!--                    class="fill-current h-6 w-6" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path-->
<!--                    fill-rule="evenodd"-->
<!--                    d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm9 4a1 1 0 10-2 0v6a1 1 0 102 0V7zm-3 2a1 1 0 10-2 0v4a1 1 0 102 0V9zm-3 3a1 1 0 10-2 0v1a1 1 0 102 0v-1z"-->
<!--                    clip-rule="evenodd"></path></svg></span></a></div>-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center" href="/calendar"><span><svg-->
<!--                    class="fill-current h-6 w-6 ml-1" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><path-->
<!--                    fill-rule="evenodd" d="M0 0h24v24H0V0z" fill="none" clip-rule="evenodd"></path><path-->
<!--                    fill-rule="evenodd"-->
<!--                    d="M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V10h16v11zm0-13H4V5h16v3z"-->
<!--                    clip-rule="evenodd"></path></svg></span></a></div>-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center" href="/calculator"><span><svg-->
<!--                    class="fill-current h-6 w-6" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path-->
<!--                    fill-rule="evenodd"-->
<!--                    d="M4.649 3.084A1 1 0 015.163 4.4 13.95 13.95 0 004 10c0 1.993.416 3.886 1.164 5.6a1 1 0 01-1.832.8A15.95 15.95 0 012 10c0-2.274.475-4.44 1.332-6.4a1 1 0 011.317-.516zM12.96 7a3 3 0 00-2.342 1.126l-.328.41-.111-.279A2 2 0 008.323 7H8a1 1 0 000 2h.323l.532 1.33-1.035 1.295a1 1 0 01-.781.375H7a1 1 0 100 2h.039a3 3 0 002.342-1.126l.328-.41.111.279A2 2 0 0011.677 14H12a1 1 0 100-2h-.323l-.532-1.33 1.035-1.295A1 1 0 0112.961 9H13a1 1 0 100-2h-.039zm1.874-2.6a1 1 0 011.833-.8A15.95 15.95 0 0118 10c0 2.274-.475 4.44-1.332 6.4a1 1 0 11-1.832-.8A13.949 13.949 0 0016 10c0-1.993-.416-3.886-1.165-5.6z"-->
<!--                    clip-rule="evenodd"></path></svg></span></a></div>-->
<!--            <div class="inline-flex relative nowrap"><a-->
<!--                    class="flex items-center py-2 w-full border-transparent justify-center" href="/affiliates"><span><svg-->
<!--                    class="fill-current h-6 w-6" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path-->
<!--                    d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"></path></svg></span></a>-->
<!--            </div>-->
<!--            <div class="inline-flex relative nowrap"><a href="https://help.quantdata.us/" target="_blank"-->
<!--                                                        rel="noopener noreferrer"-->
<!--                                                        class="flex items-center py-2 w-full border-transparent justify-center">-->
<!--                <svg class="fill-current h-5 w-5" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">-->
<!--                    <path fill-rule="evenodd"-->
<!--                          d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"-->
<!--                          clip-rule="evenodd"></path>-->
<!--                </svg>-->
<!--            </a></div>-->
<!--        </div>-->
<!--        <div class="hidden md:flex pb-2 items-center justify-center">-->
<!--            <button class="focus:outline-none focus:ring-0 py-2 hover:bg-quantBlue hover:bg-opacity-20 px-2.5">-->
<!--                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">-->
<!--                    <path fill-rule="evenodd"-->
<!--                          d="M10.293 15.707a1 1 0 010-1.414L14.586 10l-4.293-4.293a1 1 0 111.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z"-->
<!--                          clip-rule="evenodd"></path>-->
<!--                    <path fill-rule="evenodd"-->
<!--                          d="M4.293 15.707a1 1 0 010-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z"-->
<!--                          clip-rule="evenodd"></path>-->
<!--                </svg>-->
<!--            </button>-->
<!--        </div>-->
<!--    </div>-->
<!--</aside>-->
<script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js" type="text/javascript"></script>
<script src="/static/js/vanilla-datetimerange-picker.js"></script>
<!--<h2>Top Modal</h2>-->

<!--&lt;!&ndash; Trigger/Open The Modal &ndash;&gt;-->
<!--<button id="myBtn">Open Modal</button>-->

<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <span class="close">&times;</span>
            <h2>Modal Header</h2>
        </div>
        <div class="modal-body">
            <p>Some text in the Modal Body</p>
            <p>Some other text...</p>
        </div>
        <div class="modal-footer">
            <h3>Modal Footer</h3>
        </div>
    </div>

</div>

<div id="checkboxes">
    <p></p>
    <script>
        const funds = ["SPX","XLB","XLC","XLE","XLF","XLI","XLK","XLP","XLU","XLV","XLY", "XRT"];
        funds.forEach((fund)=>{
            //  generate id
            const id = `fund-${fund}`;

            // create a label
            const label = document.createElement('label');
            label.setAttribute("for", id);

            // create a checkbox
            const checkbox = document.createElement('input');
            checkbox.type = "checkbox";
            checkbox.name = "fund";
            checkbox.value = fund;
            checkbox.id = id;
            checkbox.checked = true;

            // place the checkbox inside a label
            label.appendChild(checkbox);
            // create text node
            label.appendChild(document.createTextNode(fund));
            // add the label to the root
            document.querySelector("#checkboxes").appendChild(label);
        });
    </script>
<!--    <p>-->
<!--        <button id="btn">Use Selected ETFs</button>-->
<!--    </p>-->
<!--    <script>-->
<!--        const btn = document.querySelector('#btn');-->
<!--        btn.addEventListener('click', (event) => {-->
<!--            let checkboxes = document.querySelectorAll('input[name="fund"]:checked');-->
<!--            let values = [];-->
<!--            checkboxes.forEach((checkbox) => {-->
<!--                values.push(checkbox.value);-->
<!--            });-->
<!--            alert(values);-->
<!--        });-->
<!--    </script>-->
</div>
<!--<script>-->
<!--    // Get the modal-->
<!--    var modal = document.getElementById("myModal");-->

<!--    // Get the button that opens the modal-->
<!--    var btn = document.getElementById("myBtn");-->

<!--    // Get the <span> element that closes the modal-->
<!--    var span = document.getElementsByClassName("close")[0];-->

<!--    // When the user clicks the button, open the modal-->
<!--    btn.onclick = function() {-->
<!--      modal.style.display = "block";-->
<!--    }-->

<!--    // When the user clicks on <span> (x), close the modal-->
<!--    span.onclick = function() {-->
<!--      modal.style.display = "none";-->
<!--    }-->

<!--    // When the user clicks anywhere outside of the modal, close it-->
<!--    window.onclick = function(event) {-->
<!--      if (event.target == modal) {-->
<!--        modal.style.display = "none";-->
<!--      }-->
<!--    }-->

<!--</script>-->
</body>
<div id="svg_container"></div>

<script>
<!--    'use strict';-->
        start_date = new Date().toLocaleDateString()
        end_date = new Date().toLocaleDateString()
        daterange = {
            'start_date': start_date,
            'end_date' : end_date
        }
        window.addEventListener("load", function (event) {
            new DateRangePicker('datetimerange-input1',
                {
                    timePicker: true,
                    maxDate: "04/04/2023",
                    opens: 'left',
                    ranges: {
                        'Today': [moment().startOf('day'), moment().endOf('day')],
                        'Yesterday': [moment().subtract(1, 'days').startOf('day'), moment().subtract(1, 'days').endOf('day')],
                        'Last 7 Days': [moment().subtract(6, 'days').startOf('day'), moment().endOf('day')],
                        'This Month': [moment().startOf('month').startOf('day'), moment().endOf('month').endOf('day')],
                    },
                    locale: {
                        format: "MM/DD/YYYY"
                    }
                },
                function (start, end) {
                        let checkboxes = document.querySelectorAll('input[name="fund"]:checked');
                        let values = [];
                        checkboxes.forEach((checkbox) => {
                            values.push(checkbox.value);
                        });
<!--                        alert(values);-->
<!--                    alert(start.format("MM/DD/YYYY") + " - " + end.format("MM/DD/YYYY"));-->
                        daterange['start_date'] = start.format("YYYYMMDD");
                        daterange['end_date'] = end.format("YYYYMMDD");

                        // update data source
                        fetch('/dataset/'+ daterange['start_date'] +'/'+ daterange['end_date'] + '/' + values)
                            .then(function(response){
<!--                                response.json().then(function(data){-->
<!--                                    if(!("error" in data)){-->
<!--                                        console.log(data);-->
<!--                                renderTreeMap("/static/data/SSData.csv");-->
                                response.json().then(function(response){
                                    renderJSONTreeMap(response);
                                })

                        })
<!--
<!--                        modal.style.display = "block";-->
                })
        });
<!-- renderTreeMap("/static/data/SSData.csv");-->


</script>
</html>
<style>
  #svg_container {
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    margin: auto;
    position: relative;
    width: 1200px;
  }
<!--  form {-->
<!--    position: absolute;-->
<!--    right: 10px;-->
<!--    top: 10px;-->
<!--  }-->
  .node {
    border: solid 1px white;
    font: 10px sans-serif;
    line-height: 12px;
    overflow: hidden;
    position: absolute;
    text-indent: 2px;
  }

</style>


