<!DOCTYPE html>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="/static/js/treemap.js"></script>
<script src="/static/js/loader.js" defer></script>
<html lang="en">
<head>
    <meta charset="UTF-8">
<!--    <link href="/static/css/nav.css" rel="stylesheet">-->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="/static/css/vanilla-datetimerange-picker.css">
    <link type="text/css" rel="stylesheet" href="/static/css/modal.css">
    <link type="text/css" rel="stylesheet" href="/static/css/loader.css">
    <title>FINRA Short Sale Data Treemap</title>
</head>
<body>
<!--<div id="payload">-->
<!--<ons-sliding-menu main-page="page1.html" menu-page="menu.html" side="left" max-slide-distance="250px" var="menu">-->
<!--</ons-sliding-menu>-->

<!--<ons-template id="page1.html">-->
<!--  <ons-page>-->
<!--    <ons-toolbar>-->
<!--      <div class="left">-->
<!--        <ons-toolbar-button ng-click="menu.toggleMenu()">-->
<!--          <ons-icon icon="ion-navicon" style="font-size: 32px; width: 1em;"></ons-icon>-->
<!--        </ons-toolbar-button>-->
<!--      </div>-->
<!--      <div class="center">Page 1</div>-->
<!--    </ons-toolbar>-->

<!--    <p style="text-align: center; color: #999; padding-top: 100px;">Page1 Contents</p>-->
<!--  </ons-page>-->
<!--</ons-template>-->


<!--<ons-template id="page2.html">-->
<!--  <ons-page>-->
<!--    <ons-toolbar>-->
<!--      <div class="left">-->
<!--        <ons-toolbar-button onclick="menu.toggleMenu()">-->
<!--          <ons-icon icon="ion-navicon" style="font-size: 32px; width: 1em;"></ons-icon>-->
<!--        </ons-toolbar-button>-->
<!--      </div>-->
<!--      <div class="center">Page 2</div>-->
<!--    </ons-toolbar>-->

<!--    <p style="text-align: center; color: #999; padding-top: 100px;">Page2 Contents</p>-->
<!--  </ons-page>-->
<!--</ons-template>-->

<!--<ons-template id="menu.html">-->
<!--  <ons-list>-->
<!--    <ons-list-item modifier="chevron" onclick="menu.setMainPage('page1.html', {closeMenu: true})">-->
<!--      page1.html-->
<!--    </ons-list-item>-->
<!--    <ons-list-item modifier="chevron" onclick="menu.setMainPage('page2.html', {closeMenu: true})">-->
<!--      page2.html-->
<!--    </ons-list-item>-->
<!--  </ons-list>-->
<!--</ons-template>-->

<!--Navigation bar-->
<div id="nav-placeholder">

</div>
<!--<script>-->
<!--    $(function(){-->
<!--      $("#nav-placeholder").load("/templates/nav.html");-->
<!--    });-->
<!--</script>-->
<div class="container">
    <h1>FINRA Short Sale Data Treemap</h1>
    <p class="lead">Select a date range for the data</p>
    <input type="text" id="datetimerange-input1" size="40"></input>
</div>

<script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js" type="text/javascript"></script>
<script src="/static/js/vanilla-datetimerange-picker.js"></script>
<!--<h2>Top Modal</h2>-->

<!--&lt;!&ndash; Trigger/Open The Modal &ndash;&gt;-->
<!--<button id="myBtn">Open Modal</button>-->

<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <span class="close">&times;</span>
            <h2>Modal Header</h2>
        </div>
        <div class="modal-body">
            <p>Some text in the Modal Body</p>
            <p>Some other text...</p>
        </div>
        <div class="modal-footer">
            <h3>Modal Footer</h3>
        </div>
    </div>

</div>

<div id="checkboxes">
    <p></p>
    <script>
        function populateTreemap(startDate, endDate) {
            let checkboxes = document.querySelectorAll('input[name="fund"]:checked');
            let values = [];
            checkboxes.forEach((checkbox) => {
                values.push(checkbox.value);
            });
            fetch('/dataset/'+ startDate +'/'+ endDate + '/' + values)
                .then(function(response){
                    response.json().then(function(response){
                        renderJSONTreeMap(response);
                        var spinner = document.querySelector(".loader");
                        spinner.classList.add("loader-hidden");
                    })
            })
        }

        const funds = ["SPX","XLB","XLC","XLE","XLF","XLI","XLK","XLP","XLU","XLV","XLY", "XRT"];
        funds.forEach((fund)=>{
            //  generate id
            const id = `fund-${fund}`;

            // create a label
            const label = document.createElement('label');
            label.setAttribute("for", id);

            // create a checkbox
            const checkbox = document.createElement('input');
            checkbox.type = "checkbox";
            checkbox.name = "fund";
            checkbox.value = fund;
            checkbox.id = id;
            checkbox.checked = true;

            // place the checkbox inside a label
            label.appendChild(checkbox);
            // create text node
            label.appendChild(document.createTextNode(fund));
            // add the label to the root
            document.querySelector("#checkboxes").appendChild(label);
        });
    </script>
<!--    <p>-->
<!--        <button id="btn">Use Selected ETFs</button>-->
<!--    </p>-->
<!--    <script>-->
<!--        const btn = document.querySelector('#btn');-->
<!--        btn.addEventListener('click', (event) => {-->
<!--            let checkboxes = document.querySelectorAll('input[name="fund"]:checked');-->
<!--            let values = [];-->
<!--            checkboxes.forEach((checkbox) => {-->
<!--                values.push(checkbox.value);-->
<!--            });-->
<!--            alert(values);-->
<!--        });-->
<!--    </script>-->
</div>
<!--<script>-->
<!--    // Get the modal-->
<!--    var modal = document.getElementById("myModal");-->

<!--    // Get the button that opens the modal-->
<!--    var btn = document.getElementById("myBtn");-->

<!--    // Get the <span> element that closes the modal-->
<!--    var span = document.getElementsByClassName("close")[0];-->

<!--    // When the user clicks the button, open the modal-->
<!--    btn.onclick = function() {-->
<!--      modal.style.display = "block";-->
<!--    }-->

<!--    // When the user clicks on <span> (x), close the modal-->
<!--    span.onclick = function() {-->
<!--      modal.style.display = "none";-->
<!--    }-->

<!--    // When the user clicks anywhere outside of the modal, close it-->
<!--    window.onclick = function(event) {-->
<!--      if (event.target == modal) {-->
<!--        modal.style.display = "none";-->
<!--      }-->
<!--    }-->

<!--</script>-->
</body>
<div class="loader"></div>
<div id="svg_container"></div>

<script>
<!--    'use strict';-->

        $(document).on('myCustomEvent', () => {
            var spinner = document.querySelector(".loader");
            spinner.classList.remove("loader-hidden");
        })

        start_date = new Date().toLocaleDateString()
        end_date = new Date().toLocaleDateString()
        daterange = {
            'start_date': start_date,
            'end_date' : end_date
        }
        window.addEventListener("load", function (event) {
            new DateRangePicker('datetimerange-input1',
                {
                    timePicker: true,
                    maxDate: moment().format('MM/DD/YYYY'),
                    opens: 'left',
                    ranges: {
                        'Today': [moment().startOf('day'), moment().endOf('day')],
                        'Yesterday': [moment().subtract(1, 'days').startOf('day'), moment().subtract(1, 'days').endOf('day')],
                        'Last 7 Days': [moment().subtract(6, 'days').startOf('day'), moment().endOf('day')],
                        'This Month': [moment().startOf('month').startOf('day'), moment().endOf('month').endOf('day')],
                    },
                    locale: {
                        format: "MM/DD/YYYY"
                    }
                },
                function (start, end) {
                    $(document).trigger("myCustomEvent");

<!--                        let checkboxes = document.querySelectorAll('input[name="fund"]:checked');-->
<!--                        let values = [];-->
<!--                        checkboxes.forEach((checkbox) => {-->
<!--                            values.push(checkbox.value);-->
<!--                        });-->
<!--                        alert(values);-->
<!--                    alert(start.format("MM/DD/YYYY") + " - " + end.format("MM/DD/YYYY"));-->
                        daterange['start_date'] = start.format("YYYYMMDD");
                        daterange['end_date'] = end.format("YYYYMMDD");

                        // update data source


<!--                        function loadTreemap() {-->
<!--                            return new Promise((resolve, reject) => {-->
<!--                                populateTreemap( daterange['start_date'], daterange['end_date']);-->
<!--                                resolve();-->
<!--                            });-->
<!--                        }-->

<!--                        loadTreemap()-->
<!--                            .then();-->


                        populateTreemap( daterange['start_date'], daterange['end_date']);
<!--                                alert("Here 2")-->


<!--                        alert("Here 3")-->




<!--                        fetch('/dataset/'+ daterange['start_date'] +'/'+ daterange['end_date'] + '/' + values)-->
<!--                            .then(function(response){-->
<!--&lt;!&ndash;                                response.json().then(function(data){&ndash;&gt;-->
<!--&lt;!&ndash;                                    if(!("error" in data)){&ndash;&gt;-->
<!--&lt;!&ndash;                                        console.log(data);&ndash;&gt;-->
<!--&lt;!&ndash;                                renderTreeMap("/static/data/SSData.csv");&ndash;&gt;-->
<!--                                response.json().then(function(response){-->
<!--                                    renderJSONTreeMap(response);-->
<!--                                })-->

<!--                        })-->
<!--
<!--                        modal.style.display = "block";-->
                })
        });


<!--renderTreeMap("/static/data/SSData.csv");-->
populateTreemap(moment().format('YYYYMMDD'),moment().format('YYYYMMDD'))

</script>
</html>
<style>
  #svg_container {
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    margin: auto;
    position: relative;
    width: 1200px;
  }
<!--  form {-->
<!--    position: absolute;-->
<!--    right: 10px;-->
<!--    top: 10px;-->
<!--  }-->
  .node {
    border: solid 1px white;
    font: 10px sans-serif;
    line-height: 12px;
    overflow: hidden;
    position: absolute;
    text-indent: 2px;
  }

</style>


